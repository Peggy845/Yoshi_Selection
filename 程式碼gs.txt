// Code.gs (Google Apps Script)
function doGet() {
  const ss = SpreadsheetApp.openById('1KXmggPfKqpg5gZCsUujlpdTcKSFdGJHv4bOux3nc2xo');
  const sheet = ss.getSheetByName('分類圖片');
  const data = sheet.getDataRange().getValues();
  
  const mainCategories = [];
  const subcategories = {};

  for (let i = 1; i < data.length; i++) {
    const mainCat = data[i][0];
    const mainImg = data[i][1];
    const subCat = data[i][2];
    const subImg = data[i][3];

    if (!mainCategories.find(c => c.name === mainCat)) {
      mainCategories.push({ name: mainCat, image: mainImg });
      subcategories[mainCat] = [{ name: '全部', image: mainImg }];
    }

    if (subCat && subImg) {
      subcategories[mainCat].push({ name: subCat, image: subImg });
    }
  }

  return ContentService
    .createTextOutput(JSON.stringify({ mainCategories, subcategories }))
    .setMimeType(ContentService.MimeType.JSON);
}
